2025-12-12T20:43:18.5436306Z ##[group]Run ruff check src/ tests/ stack_bootstrapper.py
2025-12-12T20:43:18.5436832Z [36;1mruff check src/ tests/ stack_bootstrapper.py[0m
2025-12-12T20:43:18.5471526Z shell: /usr/bin/bash -e {0}
2025-12-12T20:43:18.5471810Z env:
2025-12-12T20:43:18.5472032Z   PYTHON_VERSION_DEFAULT: 3.11
2025-12-12T20:43:18.5472379Z   pythonLocation: /opt/hostedtoolcache/Python/3.11.14/x64
2025-12-12T20:43:18.5472826Z   PKG_CONFIG_PATH: /opt/hostedtoolcache/Python/3.11.14/x64/lib/pkgconfig
2025-12-12T20:43:18.5473267Z   Python_ROOT_DIR: /opt/hostedtoolcache/Python/3.11.14/x64
2025-12-12T20:43:18.5473657Z   Python2_ROOT_DIR: /opt/hostedtoolcache/Python/3.11.14/x64
2025-12-12T20:43:18.5474314Z   Python3_ROOT_DIR: /opt/hostedtoolcache/Python/3.11.14/x64
2025-12-12T20:43:18.5474709Z   LD_LIBRARY_PATH: /opt/hostedtoolcache/Python/3.11.14/x64/lib
2025-12-12T20:43:18.5475088Z ##[endgroup]
2025-12-12T20:43:18.5687358Z E501 Line too long (105 > 88)
2025-12-12T20:43:18.5688064Z   --> src/stack/config/generators.py:92:89
2025-12-12T20:43:18.5688690Z    |
2025-12-12T20:43:18.5689407Z 90 | [tool.pytest.ini_options]
2025-12-12T20:43:18.5689914Z 91 | testpaths = ["tests"]
2025-12-12T20:43:18.5690760Z 92 | addopts = "-v --cov=src --cov-report=html --cov-report=term-missing --cov-fail-under=80 --strict-markers"
2025-12-12T20:43:18.5691664Z    |                                                                                         ^^^^^^^^^^^^^^^^^
2025-12-12T20:43:18.5692204Z 93 | markers = [
2025-12-12T20:43:18.5692793Z 94 |     "slow: marks tests as slow (deselect with '-m \"not slow\"')",
2025-12-12T20:43:18.5693382Z    |
2025-12-12T20:43:18.5693569Z 
2025-12-12T20:43:18.5693779Z E501 Line too long (92 > 88)
2025-12-12T20:43:18.5694472Z   --> src/stack/config/models.py:44:89
2025-12-12T20:43:18.5694991Z    |
2025-12-12T20:43:18.5695545Z 42 |     enable_safety: bool = Field(default=True, description="Enable Safety SCA")
2025-12-12T20:43:18.5696458Z 43 |     enable_semgrep: bool = Field(default=True, description="Enable Semgrep")
2025-12-12T20:43:18.5697460Z 44 |     enable_detect_secrets: bool = Field(default=True, description="Enable secret detection")
2025-12-12T20:43:18.5698282Z    |                                                                                         ^^^^
2025-12-12T20:43:18.5698950Z 45 |     bandit_severity: Literal["low", "medium", "high"] = Field(
2025-12-12T20:43:18.5699557Z 46 |         default="low",
2025-12-12T20:43:18.5700434Z    |
2025-12-12T20:43:18.5701063Z 
2025-12-12T20:43:18.5701252Z E501 Line too long (90 > 88)
2025-12-12T20:43:18.5701790Z    --> src/stack/config/models.py:235:89
2025-12-12T20:43:18.5702263Z     |
2025-12-12T20:43:18.5702626Z 233 |         pattern = r"^\d+\.\d+$"
2025-12-12T20:43:18.5703110Z 234 |         if not re.match(pattern, value):
2025-12-12T20:43:18.5703816Z 235 |             msg = f"Python version '{value}' is invalid. Use format 'X.Y' (e.g., '3.12')."
2025-12-12T20:43:18.5704751Z     |                                                                                         ^^
2025-12-12T20:43:18.5705305Z 236 |             raise ValueError(msg)
2025-12-12T20:43:18.5705756Z     |
2025-12-12T20:43:18.5705937Z 
2025-12-12T20:43:18.5706391Z PLR2004 Magic value used in comparison, consider replacing `3` with a constant variable
2025-12-12T20:43:18.5707162Z    --> src/stack/config/models.py:239:20
2025-12-12T20:43:18.5707634Z     |
2025-12-12T20:43:18.5708037Z 238 |         major, minor = map(int, value.split("."))
2025-12-12T20:43:18.5708643Z 239 |         if major < 3 or (major == 3 and minor < 10):
2025-12-12T20:43:18.5709159Z     |                    ^
2025-12-12T20:43:18.5709729Z 240 |             msg = f"Python version {value} is not supported. Minimum is 3.10."
2025-12-12T20:43:18.5710367Z 241 |             raise ValueError(msg)
2025-12-12T20:43:18.5710806Z     |
2025-12-12T20:43:18.5710985Z 
2025-12-12T20:43:18.5711395Z PLR2004 Magic value used in comparison, consider replacing `3` with a constant variable
2025-12-12T20:43:18.5712136Z    --> src/stack/config/models.py:239:35
2025-12-12T20:43:18.5712856Z     |
2025-12-12T20:43:18.5713263Z 238 |         major, minor = map(int, value.split("."))
2025-12-12T20:43:18.5713845Z 239 |         if major < 3 or (major == 3 and minor < 10):
2025-12-12T20:43:18.5714530Z     |                                   ^
2025-12-12T20:43:18.5715158Z 240 |             msg = f"Python version {value} is not supported. Minimum is 3.10."
2025-12-12T20:43:18.5715795Z 241 |             raise ValueError(msg)
2025-12-12T20:43:18.5716257Z     |
2025-12-12T20:43:18.5716427Z 
2025-12-12T20:43:18.5716830Z PLR2004 Magic value used in comparison, consider replacing `10` with a constant variable
2025-12-12T20:43:18.5717384Z    --> src/stack/config/models.py:239:49
2025-12-12T20:43:18.5717673Z     |
2025-12-12T20:43:18.5717924Z 238 |         major, minor = map(int, value.split("."))
2025-12-12T20:43:18.5718282Z 239 |         if major < 3 or (major == 3 and minor < 10):
2025-12-12T20:43:18.5718607Z     |                                                 ^^
2025-12-12T20:43:18.5719024Z 240 |             msg = f"Python version {value} is not supported. Minimum is 3.10."
2025-12-12T20:43:18.5719470Z 241 |             raise ValueError(msg)
2025-12-12T20:43:18.5720091Z     |
2025-12-12T20:43:18.5720320Z 
2025-12-12T20:43:18.5720670Z SIM102 Use a single `if` statement instead of nested `if` statements
2025-12-12T20:43:18.5721317Z    --> src/stack/config/models.py:281:9
2025-12-12T20:43:18.5721763Z     |
2025-12-12T20:43:18.5721971Z 279 |           """
2025-12-12T20:43:18.5722299Z 280 |           # If paranoid security, ensure all security tools are enabled
2025-12-12T20:43:18.5722702Z 281 | /         if self.security.level == "paranoid":
2025-12-12T20:43:18.5723007Z 282 | |             if not all([
2025-12-12T20:43:18.5723295Z 283 | |                 self.security.enable_bandit,
2025-12-12T20:43:18.5723624Z 284 | |                 self.security.enable_safety,
2025-12-12T20:43:18.5724156Z 285 | |                 self.security.enable_semgrep,
2025-12-12T20:43:18.5724514Z 286 | |                 self.security.enable_detect_secrets,
2025-12-12T20:43:18.5724822Z 287 | |             ]):
2025-12-12T20:43:18.5725059Z     | |_______________^
2025-12-12T20:43:18.5725389Z 288 |                   msg = "Paranoid security level requires all security tools enabled."
2025-12-12T20:43:18.5725795Z 289 |                   raise ValueError(msg)
2025-12-12T20:43:18.5726064Z     |
2025-12-12T20:43:18.5726302Z help: Combine `if` statements using `and`
2025-12-12T20:43:18.5726673Z 
2025-12-12T20:43:18.5727080Z SIM108 Use ternary operator `resolved = path.resolve() if path.is_absolute() else (base_dir / path).resolve()` instead of `if`-`else`-block
2025-12-12T20:43:18.5727655Z    --> src/stack/security/guards.py:96:9
2025-12-12T20:43:18.5727936Z     |
2025-12-12T20:43:18.5728147Z  94 |       # Resolve the path
2025-12-12T20:43:18.5728396Z  95 |       try:
2025-12-12T20:43:18.5728623Z  96 | /         if path.is_absolute():
2025-12-12T20:43:18.5728924Z  97 | |             resolved = path.resolve()
2025-12-12T20:43:18.5729209Z  98 | |         else:
2025-12-12T20:43:18.5729476Z  99 | |             resolved = (base_dir / path).resolve()
2025-12-12T20:43:18.5729807Z     | |__________________________________________________^
2025-12-12T20:43:18.5730128Z 100 |       except (OSError, ValueError) as e:
2025-12-12T20:43:18.5730440Z 101 |           raise SecurityError(
2025-12-12T20:43:18.5730696Z     |
2025-12-12T20:43:18.5731157Z help: Replace `if`-`else`-block with `resolved = path.resolve() if path.is_absolute() else (base_dir / path).resolve()`
2025-12-12T20:43:18.5731565Z 
2025-12-12T20:43:18.5731774Z SIM102 Use a single `if` statement instead of nested `if` statements
2025-12-12T20:43:18.5732173Z    --> src/stack/security/guards.py:117:5
2025-12-12T20:43:18.5732454Z     |
2025-12-12T20:43:18.5732698Z 116 |       # Check for symlinks if not allowed
2025-12-12T20:43:18.5733060Z 117 | /     if not allow_symlinks and resolved.exists():
2025-12-12T20:43:18.5733405Z 118 | |         if resolved.is_symlink():
2025-12-12T20:43:18.5733858Z     | |_________________________________^
2025-12-12T20:43:18.5734385Z 119 |               raise SecurityError(
2025-12-12T20:43:18.5734714Z 120 |                   "Symlinks are not allowed",
2025-12-12T20:43:18.5734996Z     |
2025-12-12T20:43:18.5797200Z help: Combine `if` statements using `and`
2025-12-12T20:43:18.5797459Z 
2025-12-12T20:43:18.5797590Z E501 Line too long (89 > 88)
2025-12-12T20:43:18.5797907Z    --> src/stack/security/guards.py:194:89
2025-12-12T20:43:18.5798247Z     |
2025-12-12T20:43:18.5798574Z 192 |         # Get just the command name without path
2025-12-12T20:43:18.5798991Z 193 |         command_name = Path(base_command).name
2025-12-12T20:43:18.5799482Z 194 |         if command_name not in allowed_commands and base_command not in allowed_commands:
2025-12-12T20:43:18.5799956Z     |                                                                                         ^
2025-12-12T20:43:18.5800278Z 195 |             raise SecurityError(
2025-12-12T20:43:18.5800668Z 196 |                 f"Command not in allowed list: {command_name}",
2025-12-12T20:43:18.5800982Z     |
2025-12-12T20:43:18.5801102Z 
2025-12-12T20:43:18.5801216Z E501 Line too long (91 > 88)
2025-12-12T20:43:18.5801523Z   --> src/stack/security/sanitizers.py:51:89
2025-12-12T20:43:18.5801838Z    |
2025-12-12T20:43:18.5802098Z 49 |     # Remove null bytes and control characters
2025-12-12T20:43:18.5802446Z 50 |     result = result.replace("\x00", "")
2025-12-12T20:43:18.5802918Z 51 |     result = "".join(c for c in result if unicodedata.category(c) != "Cc" or c in "\n\r\t")
2025-12-12T20:43:18.5803388Z    |                                                                                         ^^^
2025-12-12T20:43:18.5803682Z 52 |
2025-12-12T20:43:18.5804086Z 53 |     # Handle HTML
2025-12-12T20:43:18.5804334Z    |
2025-12-12T20:43:18.5804444Z 
2025-12-12T20:43:18.5804582Z PLR0912 Too many branches (13 > 12)
2025-12-12T20:43:18.5804900Z    --> src/stack/security/sanitizers.py:155:5
2025-12-12T20:43:18.5805197Z     |
2025-12-12T20:43:18.5805418Z 155 | def sanitize_path(
2025-12-12T20:43:18.5805665Z     |     ^^^^^^^^^^^^^
2025-12-12T20:43:18.5805909Z 156 |     path: str | Path,
2025-12-12T20:43:18.5806155Z 157 |     *,
2025-12-12T20:43:18.5806353Z     |
2025-12-12T20:43:18.5806469Z 
2025-12-12T20:43:18.5806758Z PLR2004 Magic value used in comparison, consider replacing `128` with a constant variable
2025-12-12T20:43:18.5807232Z    --> src/stack/security/sanitizers.py:290:22
2025-12-12T20:43:18.5807715Z     |
2025-12-12T20:43:18.5807978Z 289 |     # Check length (most DBs limit to 128 chars)
2025-12-12T20:43:18.5808289Z 290 |     if len(result) > 128:
2025-12-12T20:43:18.5808557Z     |                      ^^^
2025-12-12T20:43:18.5808819Z 291 |         result = result[:128]
2025-12-12T20:43:18.5809073Z     |
2025-12-12T20:43:18.5809212Z 
2025-12-12T20:43:18.5809334Z E501 Line too long (166 > 88)
2025-12-12T20:43:18.5809646Z   --> src/stack/security/validators.py:65:89
2025-12-12T20:43:18.5809971Z    |
2025-12-12T20:43:18.5810360Z 63 | …
2025-12-12T20:43:18.5810577Z 64 | …
2025-12-12T20:43:18.5811207Z 65 | …owed: letters, numbers{', hyphens' if allow_hyphen else ''}{', underscores' if allow_underscore else ''}"
2025-12-12T20:43:18.5811766Z    |                             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-12-12T20:43:18.5812077Z 66 | …
2025-12-12T20:43:18.5812274Z    |
2025-12-12T20:43:18.5812382Z 
2025-12-12T20:43:18.5812684Z PLR2004 Magic value used in comparison, consider replacing `3` with a constant variable
2025-12-12T20:43:18.5813153Z    --> src/stack/security/validators.py:118:17
2025-12-12T20:43:18.5813448Z     |
2025-12-12T20:43:18.5813681Z 116 |         raise ValueError(msg) from e
2025-12-12T20:43:18.5814145Z 117 |
2025-12-12T20:43:18.5814360Z 118 |     if major != 3:
2025-12-12T20:43:18.5814611Z     |                 ^
2025-12-12T20:43:18.5814919Z 119 |         msg = f"Only Python 3.x is supported, got {major}.x"
2025-12-12T20:43:18.5815270Z 120 |         raise ValueError(msg)
2025-12-12T20:43:18.5815681Z     |
2025-12-12T20:43:18.5815790Z 
2025-12-12T20:43:18.5816067Z PLR2004 Magic value used in comparison, consider replacing `10` with a constant variable
2025-12-12T20:43:18.5816535Z    --> src/stack/security/validators.py:122:16
2025-12-12T20:43:18.5816818Z     |
2025-12-12T20:43:18.5817034Z 120 |         raise ValueError(msg)
2025-12-12T20:43:18.5817279Z 121 |
2025-12-12T20:43:18.5817486Z 122 |     if minor < 10:
2025-12-12T20:43:18.5817733Z     |                ^^
2025-12-12T20:43:18.5818067Z 123 |         msg = f"Python 3.{minor} is not supported. Minimum is 3.10"
2025-12-12T20:43:18.5818437Z 124 |         raise ValueError(msg)
2025-12-12T20:43:18.5818683Z     |
2025-12-12T20:43:18.5818791Z 
2025-12-12T20:43:18.5819077Z PLR2004 Magic value used in comparison, consider replacing `64` with a constant variable
2025-12-12T20:43:18.5819535Z    --> src/stack/security/validators.py:159:21
2025-12-12T20:43:18.5819820Z     |
2025-12-12T20:43:18.5820056Z 157 |     local, domain = email.rsplit("@", 1)
2025-12-12T20:43:18.5820344Z 158 |
2025-12-12T20:43:18.5820553Z 159 |     if len(local) > 64:
2025-12-12T20:43:18.5820814Z     |                     ^^
2025-12-12T20:43:18.5821121Z 160 |         msg = "Email local part exceeds 64 characters"
2025-12-12T20:43:18.5821452Z 161 |         raise ValueError(msg)
2025-12-12T20:43:18.5821701Z     |
2025-12-12T20:43:18.5821811Z 
2025-12-12T20:43:18.5822089Z PLR2004 Magic value used in comparison, consider replacing `255` with a constant variable
2025-12-12T20:43:18.5822554Z    --> src/stack/security/validators.py:163:22
2025-12-12T20:43:18.5822829Z     |
2025-12-12T20:43:18.5823045Z 161 |         raise ValueError(msg)
2025-12-12T20:43:18.5823291Z 162 |
2025-12-12T20:43:18.5823506Z 163 |     if len(domain) > 255:
2025-12-12T20:43:18.5823764Z     |                      ^^^
2025-12-12T20:43:18.5824646Z 164 |         msg = "Email domain exceeds 255 characters"
2025-12-12T20:43:18.5825007Z 165 |         raise ValueError(msg)
2025-12-12T20:43:18.5825274Z     |
2025-12-12T20:43:18.5825383Z 
2025-12-12T20:43:18.5825740Z SIM102 Use a single `if` statement instead of nested `if` statements
2025-12-12T20:43:18.5826138Z    --> src/stack/security/validators.py:215:9
2025-12-12T20:43:18.5826421Z     |
2025-12-12T20:43:18.5826661Z 213 |           # Check for TLD (at least one dot)
2025-12-12T20:43:18.5827079Z 214 |           domain = parsed.netloc.split(":")[0]  # Remove port if present
2025-12-12T20:43:18.5827657Z 215 | /         if "." not in domain or domain.endswith("."):
2025-12-12T20:43:18.5828024Z 216 | |             # Allow localhost for development
2025-12-12T20:43:18.5828488Z 217 | |             if domain.lower() not in ("localhost", "127.0.0.1", "::1"):
2025-12-12T20:43:18.5828914Z     | |_______________________________________________________________________^
2025-12-12T20:43:18.5829305Z 218 |                   msg = f"URL domain must have a TLD: {domain}"
2025-12-12T20:43:18.5829659Z 219 |                   raise ValueError(msg)
2025-12-12T20:43:18.5829948Z     |
2025-12-12T20:43:18.5830188Z help: Combine `if` statements using `and`
2025-12-12T20:43:18.5830382Z 
2025-12-12T20:43:18.5830681Z PLR2004 Magic value used in comparison, consider replacing `65535` with a constant variable
2025-12-12T20:43:18.5831152Z    --> src/stack/security/validators.py:289:35
2025-12-12T20:43:18.5831442Z     |
2025-12-12T20:43:18.5831670Z 287 |         raise ValueError(msg) from e
2025-12-12T20:43:18.5831943Z 288 |
2025-12-12T20:43:18.5832196Z 289 |     if port_int < 0 or port_int > 65535:
2025-12-12T20:43:18.5832501Z     |                                   ^^^^^
2025-12-12T20:43:18.5832849Z 290 |         msg = f"Port must be between 0 and 65535: {port_int}"
2025-12-12T20:43:18.5833187Z 291 |         raise ValueError(msg)
2025-12-12T20:43:18.5833442Z     |
2025-12-12T20:43:18.5833550Z 
2025-12-12T20:43:18.5833825Z PLR2004 Magic value used in comparison, consider replacing `1024` with a constant variable
2025-12-12T20:43:18.5834532Z    --> src/stack/security/validators.py:293:44
2025-12-12T20:43:18.5834968Z     |
2025-12-12T20:43:18.5835181Z 291 |         raise ValueError(msg)
2025-12-12T20:43:18.5835435Z 292 |
2025-12-12T20:43:18.5835687Z 293 |     if not allow_privileged and port_int < 1024:
2025-12-12T20:43:18.5836021Z     |                                            ^^^^
2025-12-12T20:43:18.5836396Z 294 |         msg = f"Privileged ports (< 1024) are not allowed: {port_int}"
2025-12-12T20:43:18.5836768Z 295 |         raise ValueError(msg)
2025-12-12T20:43:18.5837024Z     |
2025-12-12T20:43:18.5837140Z 
2025-12-12T20:43:18.5837318Z PLR0913 Too many arguments in function definition (7 > 5)
2025-12-12T20:43:18.5837679Z   --> src/stack/utils/filesystem.py:69:5
2025-12-12T20:43:18.5837949Z    |
2025-12-12T20:43:18.5838154Z 69 | def safe_write(
2025-12-12T20:43:18.5838376Z    |     ^^^^^^^^^^
2025-12-12T20:43:18.5838617Z 70 |     path: Path | str,
2025-12-12T20:43:18.5838861Z 71 |     content: str,
2025-12-12T20:43:18.5839082Z    |
2025-12-12T20:43:18.5839190Z 
2025-12-12T20:43:18.5839335Z RUF059 Unpacked variable `fd` is never used
2025-12-12T20:43:18.5839661Z    --> src/stack/utils/filesystem.py:127:9
2025-12-12T20:43:18.5839935Z     |
2025-12-12T20:43:18.5840137Z 125 |     if atomic:
2025-12-12T20:43:18.5840412Z 126 |         # Write to temp file first, then rename
2025-12-12T20:43:18.5840749Z 127 |         fd, temp_path = tempfile.mkstemp(
2025-12-12T20:43:18.5841040Z     |         ^^
2025-12-12T20:43:18.5841273Z 128 |             dir=path.parent,
2025-12-12T20:43:18.5841575Z 129 |             prefix=f".{path.name}.",
2025-12-12T20:43:18.5841839Z     |
2025-12-12T20:43:18.5842152Z help: Prefix it with an underscore or any other dummy variable pattern
2025-12-12T20:43:18.5842422Z 
2025-12-12T20:43:18.5842533Z E501 Line too long (118 > 88)
2025-12-12T20:43:18.5842815Z   --> src/stack/utils/logging.py:24:89
2025-12-12T20:43:18.5843083Z    |
2025-12-12T20:43:18.5843287Z 22 | # Default log format
2025-12-12T20:43:18.5843648Z 23 | DEFAULT_FORMAT = "%(asctime)s | %(levelname)-8s | %(name)s | %(message)s"
2025-12-12T20:43:18.5844466Z 24 | JSON_FORMAT = '{"timestamp": "%(asctime)s", "level": "%(levelname)s", "logger": "%(name)s", "message": "%(message)s"}'
2025-12-12T20:43:18.5845010Z    |                                                                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-12-12T20:43:18.5845302Z    |
2025-12-12T20:43:18.5845423Z 
2025-12-12T20:43:18.5845587Z PLC0415 `import` should be at the top-level of a file
2025-12-12T20:43:18.5846078Z    --> src/stack/utils/logging.py:295:5
2025-12-12T20:43:18.5846353Z     |
2025-12-12T20:43:18.5846553Z 294 |     """
2025-12-12T20:43:18.5846805Z 295 |     from contextlib import contextmanager
2025-12-12T20:43:18.5847121Z     |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-12-12T20:43:18.5847378Z 296 |
2025-12-12T20:43:18.5847598Z 297 |     @contextmanager
2025-12-12T20:43:18.5847824Z     |
2025-12-12T20:43:18.5847935Z 
2025-12-12T20:43:18.5848114Z TRY400 Use `logging.exception` instead of `logging.error`
2025-12-12T20:43:18.5848487Z    --> src/stack/utils/logging.py:315:13
2025-12-12T20:43:18.5848754Z     |
2025-12-12T20:43:18.5848981Z 313 |           except Exception as e:
2025-12-12T20:43:18.5849397Z 314 |               duration = (datetime.now(timezone.utc) - start_time).total_seconds()
2025-12-12T20:43:18.5849798Z 315 | /             logger.error(
2025-12-12T20:43:18.5850084Z 316 | |                 f"Failed: {operation}",
2025-12-12T20:43:18.5850406Z 317 | |                 duration_seconds=duration,
2025-12-12T20:43:18.5850712Z 318 | |                 error=str(e),
2025-12-12T20:43:18.5850974Z 319 | |             )
2025-12-12T20:43:18.5851199Z     | |_____________^
2025-12-12T20:43:18.5851427Z 320 |               raise
2025-12-12T20:43:18.5851669Z 321 |           finally:
2025-12-12T20:43:18.5851905Z     |
2025-12-12T20:43:18.5852124Z help: Replace with `exception`
2025-12-12T20:43:18.5852292Z 
2025-12-12T20:43:18.5852461Z PLR0913 Too many arguments in function definition (8 > 5)
2025-12-12T20:43:18.5852836Z    --> src/stack/utils/subprocess.py:100:5
2025-12-12T20:43:18.5853236Z     |
2025-12-12T20:43:18.5853446Z 100 | def run_safe_command(
2025-12-12T20:43:18.5853693Z     |     ^^^^^^^^^^^^^^^^
2025-12-12T20:43:18.5854110Z 101 |     command: Sequence[str],
2025-12-12T20:43:18.5854371Z 102 |     *,
2025-12-12T20:43:18.5854568Z     |
2025-12-12T20:43:18.5854677Z 
2025-12-12T20:43:18.5854847Z PLC0415 `import` should be at the top-level of a file
2025-12-12T20:43:18.5855201Z    --> src/stack/utils/subprocess.py:141:5
2025-12-12T20:43:18.5855479Z     |
2025-12-12T20:43:18.5855666Z 140 |     """
2025-12-12T20:43:18.5855880Z 141 |     import time
2025-12-12T20:43:18.5856101Z     |     ^^^^^^^^^^^
2025-12-12T20:43:18.5856310Z 142 |
2025-12-12T20:43:18.5856519Z 143 |     # Convert to list
2025-12-12T20:43:18.5856744Z     |
2025-12-12T20:43:18.5856855Z 
2025-12-12T20:43:18.5857049Z S603 `subprocess` call: check for execution of untrusted input
2025-12-12T20:43:18.5857416Z    --> src/stack/utils/subprocess.py:193:18
2025-12-12T20:43:18.5857700Z     |
2025-12-12T20:43:18.5857888Z 192 |     try:
2025-12-12T20:43:18.5858127Z 193 |         result = subprocess.run(
2025-12-12T20:43:18.5858401Z     |                  ^^^^^^^^^^^^^^
2025-12-12T20:43:18.5858669Z 194 |             validated_cmd,
2025-12-12T20:43:18.5858925Z 195 |             cwd=cwd,
2025-12-12T20:43:18.5859145Z     |
2025-12-12T20:43:18.5859251Z 
2025-12-12T20:43:18.5859368Z E501 Line too long (110 > 88)
2025-12-12T20:43:18.5859651Z    --> src/stack/utils/subprocess.py:207:89
2025-12-12T20:43:18.5859937Z     |
2025-12-12T20:43:18.5860143Z 205 |         stdout_str = ""
2025-12-12T20:43:18.5860461Z 206 |         if hasattr(e, "stdout") and e.stdout is not None:
2025-12-12T20:43:18.5861002Z 207 |             stdout_str = e.stdout if isinstance(e.stdout, str) else e.stdout.decode("utf-8", errors="replace")
2025-12-12T20:43:18.5861515Z     |                                                                                         ^^^^^^^^^^^^^^^^^^^^^^
2025-12-12T20:43:18.5861858Z 208 |         return SafeCommandResult(
2025-12-12T20:43:18.5862151Z 209 |             command=validated_cmd,
2025-12-12T20:43:18.5862419Z     |
2025-12-12T20:43:18.5862527Z 
2025-12-12T20:43:18.5862729Z PLW2901 `for` loop variable `line` overwritten by assignment target
2025-12-12T20:43:18.5863122Z    --> src/stack/utils/subprocess.py:335:17
2025-12-12T20:43:18.5863400Z     |
2025-12-12T20:43:18.5863633Z 333 |             # Return first non-empty line
2025-12-12T20:43:18.5864222Z 334 |             for line in result.stdout.split("\n"):
2025-12-12T20:43:18.5864547Z 335 |                 line = line.strip()
2025-12-12T20:43:18.5864827Z     |                 ^^^^
2025-12-12T20:43:18.5865064Z 336 |                 if line:
2025-12-12T20:43:18.5865317Z 337 |                     return line
2025-12-12T20:43:18.5865562Z     |
2025-12-12T20:43:18.5865678Z 
2025-12-12T20:43:18.5865850Z TRY300 Consider moving this statement to an `else` block
2025-12-12T20:43:18.5866211Z    --> src/stack/utils/subprocess.py:338:9
2025-12-12T20:43:18.5866488Z     |
2025-12-12T20:43:18.5866697Z 336 |                 if line:
2025-12-12T20:43:18.5866945Z 337 |                     return line
2025-12-12T20:43:18.5867209Z 338 |         return None
2025-12-12T20:43:18.5867442Z     |         ^^^^^^^^^^^
2025-12-12T20:43:18.5867754Z 339 |     except (SecurityError, subprocess.SubprocessError):
2025-12-12T20:43:18.5868088Z 340 |         return None
2025-12-12T20:43:18.5868312Z     |
2025-12-12T20:43:18.5868428Z 
2025-12-12T20:43:18.5868589Z UP009 [*] UTF-8 encoding declaration is unnecessary
2025-12-12T20:43:18.5868916Z  --> stack_bootstrapper.py:2:1
2025-12-12T20:43:18.5869161Z   |
2025-12-12T20:43:18.5869365Z 1 | #!/usr/bin/env python
2025-12-12T20:43:18.5869619Z 2 | # -*- coding: utf-8 -*-
2025-12-12T20:43:18.5869864Z   | ^^^^^^^^^^^^^^^^^^^^^^^
2025-12-12T20:43:18.5870094Z 3 | """
2025-12-12T20:43:18.5870576Z 4 | Este script automatiza a configuração inicial de um ambiente Python focado em
2025-12-12T20:43:18.5870984Z   |
2025-12-12T20:43:18.5871406Z help: Remove unnecessary coding comment
2025-12-12T20:43:18.5871607Z 
2025-12-12T20:43:18.5871802Z D205 1 blank line required between summary line and description
2025-12-12T20:43:18.5872183Z  --> stack_bootstrapper.py:3:1
2025-12-12T20:43:18.5872426Z   |
2025-12-12T20:43:18.5872634Z 1 |   #!/usr/bin/env python
2025-12-12T20:43:18.5872888Z 2 |   # -*- coding: utf-8 -*-
2025-12-12T20:43:18.5873133Z 3 | / """
2025-12-12T20:43:18.5873552Z 4 | | Este script automatiza a configuração inicial de um ambiente Python focado em
2025-12-12T20:43:18.5874271Z 5 | | performance, segurança e integridade.
2025-12-12T20:43:18.5874560Z 6 | | """
2025-12-12T20:43:18.5874758Z   | |___^
2025-12-12T20:43:18.5874942Z 7 |
2025-12-12T20:43:18.5875144Z 8 |   __version__ = "1.0.0"
2025-12-12T20:43:18.5875375Z   |
2025-12-12T20:43:18.5875584Z help: Insert single blank line
2025-12-12T20:43:18.5875748Z 
2025-12-12T20:43:18.5875916Z UP035 `typing.List` is deprecated, use `list` instead
2025-12-12T20:43:18.5876258Z   --> stack_bootstrapper.py:17:1
2025-12-12T20:43:18.5876528Z    |
2025-12-12T20:43:18.5876719Z 15 | import sys
2025-12-12T20:43:18.5876968Z 16 | from pathlib import Path
2025-12-12T20:43:18.5877249Z 17 | from typing import List, NoReturn
2025-12-12T20:43:18.5877549Z    | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-12-12T20:43:18.5877806Z 18 |
2025-12-12T20:43:18.5878068Z 19 | # Constantes de configuração
2025-12-12T20:43:18.5878327Z    |
2025-12-12T20:43:18.5878434Z 
2025-12-12T20:43:18.5878545Z T201 `print` found
2025-12-12T20:43:18.5878796Z   --> stack_bootstrapper.py:35:5
2025-12-12T20:43:18.5879042Z    |
2025-12-12T20:43:18.5879296Z 34 |     prefix = "[DRY-RUN] " if args.dry_run else ""
2025-12-12T20:43:18.5879618Z 35 |     print(f"{prefix}{message}")
2025-12-12T20:43:18.5879883Z    |     ^^^^^
2025-12-12T20:43:18.5880086Z 36 |
2025-12-12T20:43:18.5880325Z 37 | def _handle_error(message: str) -> NoReturn:
2025-12-12T20:43:18.5880619Z    |
2025-12-12T20:43:18.5880822Z help: Remove `print`
2025-12-12T20:43:18.5880964Z 
2025-12-12T20:43:18.5881077Z T201 `print` found
2025-12-12T20:43:18.5881321Z   --> stack_bootstrapper.py:39:5
2025-12-12T20:43:18.5881578Z    |
2025-12-12T20:43:18.5881815Z 37 | def _handle_error(message: str) -> NoReturn:
2025-12-12T20:43:18.5882176Z 38 |     """Exibe uma mensagem de erro e encerra o script."""
2025-12-12T20:43:18.5882593Z 39 |     print(f"❌ Erro: {message}", file=sys.stderr)
2025-12-12T20:43:18.5882890Z    |     ^^^^^
2025-12-12T20:43:18.5883251Z 40 |     sys.exit(1)
2025-12-12T20:43:18.5883460Z    |
2025-12-12T20:43:18.5883669Z help: Remove `print`
2025-12-12T20:43:18.5883805Z 
2025-12-12T20:43:18.5884086Z UP006 [*] Use `list` instead of `List` for type annotation
2025-12-12T20:43:18.5884442Z   --> stack_bootstrapper.py:43:14
2025-12-12T20:43:18.5884696Z    |
2025-12-12T20:43:18.5884896Z 42 | def _run_command(
2025-12-12T20:43:18.5885265Z 43 |     command: List[str], args: argparse.Namespace, capture_output: bool = False
2025-12-12T20:43:18.5885647Z    |              ^^^^
2025-12-12T20:43:18.5885923Z 44 | ) -> subprocess.CompletedProcess[str]:
2025-12-12T20:43:18.5886319Z 45 |     """Executa um comando no shell, tratando erros e modo dry-run."""
2025-12-12T20:43:18.5886656Z    |
2025-12-12T20:43:18.5886864Z help: Replace with `list`
2025-12-12T20:43:18.5887022Z 
2025-12-12T20:43:18.5887208Z S603 `subprocess` call: check for execution of untrusted input
2025-12-12T20:43:18.5887572Z   --> stack_bootstrapper.py:51:18
2025-12-12T20:43:18.5887828Z    |
2025-12-12T20:43:18.5888025Z 50 |     try:
2025-12-12T20:43:18.5888265Z 51 |         result = subprocess.run(
2025-12-12T20:43:18.5888545Z    |                  ^^^^^^^^^^^^^^
2025-12-12T20:43:18.5888804Z 52 |             command,
2025-12-12T20:43:18.5889052Z 53 |             check=True,
2025-12-12T20:43:18.5889282Z    |
2025-12-12T20:43:18.5889398Z 
2025-12-12T20:43:18.5889565Z Q000 [*] Single quotes found but double quotes preferred
2025-12-12T20:43:18.5889903Z   --> stack_bootstrapper.py:55:22
2025-12-12T20:43:18.5890165Z    |
2025-12-12T20:43:18.5890494Z 53 |             check=True,
2025-12-12T20:43:18.5890742Z 54 |             text=True,
2025-12-12T20:43:18.5890994Z 55 |             encoding='utf-8',
2025-12-12T20:43:18.5891252Z    |                      ^^^^^^^
2025-12-12T20:43:18.5891542Z 56 |             capture_output=capture_output,
2025-12-12T20:43:18.5891825Z 57 |         )
2025-12-12T20:43:18.5892034Z    |
2025-12-12T20:43:18.5892274Z help: Replace single quotes with double quotes
2025-12-12T20:43:18.5892495Z 
2025-12-12T20:43:18.5892664Z TRY300 Consider moving this statement to an `else` block
2025-12-12T20:43:18.5893007Z   --> stack_bootstrapper.py:58:9
2025-12-12T20:43:18.5893267Z    |
2025-12-12T20:43:18.5893504Z 56 |             capture_output=capture_output,
2025-12-12T20:43:18.5893790Z 57 |         )
2025-12-12T20:43:18.5894113Z 58 |         return result
2025-12-12T20:43:18.5894355Z    |         ^^^^^^^^^^^^^
2025-12-12T20:43:18.5894612Z 59 |     except FileNotFoundError:
2025-12-12T20:43:18.5895132Z 60 |         # A verificação de Poetry é tratada separadamente, então este é um erro inesperado.
2025-12-12T20:43:18.5895551Z    |
2025-12-12T20:43:18.5895660Z 
2025-12-12T20:43:18.5895769Z E501 Line too long (91 > 88)
2025-12-12T20:43:18.5896043Z   --> stack_bootstrapper.py:60:89
2025-12-12T20:43:18.5896304Z    |
2025-12-12T20:43:18.5896505Z 58 |         return result
2025-12-12T20:43:18.5896766Z 59 |     except FileNotFoundError:
2025-12-12T20:43:18.5897246Z 60 |         # A verificação de Poetry é tratada separadamente, então este é um erro inesperado.
2025-12-12T20:43:18.5897722Z    |                                                                                         ^^^
2025-12-12T20:43:18.5898293Z 61 |         _handle_error(f"Comando '{command[0]}' não encontrado. Verifique se ele está instalado e no PATH.")
2025-12-12T20:43:18.5898801Z 62 |     except subprocess.CalledProcessError as e:
2025-12-12T20:43:18.5899100Z    |
2025-12-12T20:43:18.5899208Z 
2025-12-12T20:43:18.5899319Z E501 Line too long (107 > 88)
2025-12-12T20:43:18.5899610Z   --> stack_bootstrapper.py:61:89
2025-12-12T20:43:18.5899862Z    |
2025-12-12T20:43:18.5900089Z 59 |     except FileNotFoundError:
2025-12-12T20:43:18.5900613Z 60 |         # A verificação de Poetry é tratada separadamente, então este é um erro inesperado.
2025-12-12T20:43:18.5901313Z 61 |         _handle_error(f"Comando '{command[0]}' não encontrado. Verifique se ele está instalado e no PATH.")
2025-12-12T20:43:18.5901811Z    |                                                                                         ^^^^^^^^^^^^^^^^^^^
2025-12-12T20:43:18.5902315Z 62 |     except subprocess.CalledProcessError as e:
2025-12-12T20:43:18.5902887Z 63 |         error_message = f"O comando `{' '.join(command)}` falhou com o código de saída {e.returncode}."
2025-12-12T20:43:18.5903298Z    |
2025-12-12T20:43:18.5903429Z 
2025-12-12T20:43:18.5903538Z E501 Line too long (103 > 88)
2025-12-12T20:43:18.5903809Z   --> stack_bootstrapper.py:63:89
2025-12-12T20:43:18.5904177Z    |
2025-12-12T20:43:18.5904647Z 61 |         _handle_error(f"Comando '{command[0]}' não encontrado. Verifique se ele está instalado e no PATH.")
2025-12-12T20:43:18.5905152Z 62 |     except subprocess.CalledProcessError as e:
2025-12-12T20:43:18.5905713Z 63 |         error_message = f"O comando `{' '.join(command)}` falhou com o código de saída {e.returncode}."
2025-12-12T20:43:18.5906186Z    |                                                                                         ^^^^^^^^^^^^^^^
2025-12-12T20:43:18.5906547Z 64 |         if e.stderr and not capture_output:
2025-12-12T20:43:18.5906879Z 65 |             error_message += f"\nErro:\n{e.stderr}"
2025-12-12T20:43:18.5907165Z    |
2025-12-12T20:43:18.5907273Z 
2025-12-12T20:43:18.5907388Z E501 Line too long (89 > 88)
2025-12-12T20:43:18.5907654Z   --> stack_bootstrapper.py:84:89
2025-12-12T20:43:18.5907909Z    |
2025-12-12T20:43:18.5908225Z 82 |             _log(f"⚠️  Backup criado: {backup_path.name}", args)
2025-12-12T20:43:18.5908605Z 83 |         except (OSError, PermissionError) as e:
2025-12-12T20:43:18.5909250Z 84 |             _handle_error(f"Não foi possível criar o backup do arquivo {path.name}: {e}")
2025-12-12T20:43:18.5909700Z    |                                                                                         ^
2025-12-12T20:43:18.5909993Z 85 |
2025-12-12T20:43:18.5910183Z 86 |     try:
2025-12-12T20:43:18.5910388Z    |
2025-12-12T20:43:18.5910495Z 
2025-12-12T20:43:18.5910603Z E501 Line too long (97 > 88)
2025-12-12T20:43:18.5910889Z    --> stack_bootstrapper.py:158:89
2025-12-12T20:43:18.5911147Z     |
2025-12-12T20:43:18.5911549Z 156 |             _handle_error(f"Não foi possível escrever no arquivo pyproject.toml: {e}")
2025-12-12T20:43:18.5911974Z 157 |     elif args.dry_run and config_to_add:
2025-12-12T20:43:18.5912524Z 158 |         _log("Adicionaria configurações de ferramentas ao pyproject.toml", args, is_verbose=True)
2025-12-12T20:43:18.5913018Z     |                                                                                         ^^^^^^^^^
2025-12-12T20:43:18.5913341Z 159 |     elif not config_to_add:
2025-12-12T20:43:18.5913821Z 160 |         _log("✅ Configurações de Ruff, Mypy e Pytest já existem no pyproject.toml.", args)
2025-12-12T20:43:18.5914323Z     |
2025-12-12T20:43:18.5914440Z 
2025-12-12T20:43:18.5914549Z E501 Line too long (91 > 88)
2025-12-12T20:43:18.5914819Z    --> stack_bootstrapper.py:160:88
2025-12-12T20:43:18.5915085Z     |
2025-12-12T20:43:18.5915533Z 158 |         _log("Adicionaria configurações de ferramentas ao pyproject.toml", args, is_verbose=True)
2025-12-12T20:43:18.5915991Z 159 |     elif not config_to_add:
2025-12-12T20:43:18.5916459Z 160 |         _log("✅ Configurações de Ruff, Mypy e Pytest já existem no pyproject.toml.", args)
2025-12-12T20:43:18.5916913Z     |                                                                                         ^^^
2025-12-12T20:43:18.5917208Z 161 |
2025-12-12T20:43:18.5917518Z 162 | def _generate_pre_commit_config(args: argparse.Namespace) -> None:
2025-12-12T20:43:18.5917874Z     |
2025-12-12T20:43:18.5917992Z 
2025-12-12T20:43:18.5918143Z UP024 [*] Replace aliased errors with `OSError`
2025-12-12T20:43:18.5918460Z    --> stack_bootstrapper.py:284:12
2025-12-12T20:43:18.5918723Z     |
2025-12-12T20:43:18.5919002Z 282 |         socket.create_connection(("pypi.org", 443), timeout=5)
2025-12-12T20:43:18.5919472Z 283 |         _log("✅ Conectividade confirmada.", args, is_verbose=True)
2025-12-12T20:43:18.5919871Z 284 |     except (socket.timeout, socket.error, OSError):
2025-12-12T20:43:18.5920351Z     |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-12-12T20:43:18.5920635Z 285 |         _handle_error(
2025-12-12T20:43:18.5920983Z 286 |             "Não foi possível conectar à internet. "
2025-12-12T20:43:18.5921285Z     |
2025-12-12T20:43:18.5921502Z help: Replace with builtin `OSError`
2025-12-12T20:43:18.5921682Z 
2025-12-12T20:43:18.5921837Z UP041 [*] Replace aliased errors with `TimeoutError`
2025-12-12T20:43:18.5922168Z    --> stack_bootstrapper.py:284:12
2025-12-12T20:43:18.5922439Z     |
2025-12-12T20:43:18.5922713Z 282 |         socket.create_connection(("pypi.org", 443), timeout=5)
2025-12-12T20:43:18.5923177Z 283 |         _log("✅ Conectividade confirmada.", args, is_verbose=True)
2025-12-12T20:43:18.5923591Z 284 |     except (socket.timeout, socket.error, OSError):
2025-12-12T20:43:18.5924030Z     |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-12-12T20:43:18.5924326Z 285 |         _handle_error(
2025-12-12T20:43:18.5924673Z 286 |             "Não foi possível conectar à internet. "
2025-12-12T20:43:18.5924972Z     |
2025-12-12T20:43:18.5925203Z help: Replace with builtin `TimeoutError`
2025-12-12T20:43:18.5925405Z 
2025-12-12T20:43:18.5925522Z PLR0912 Too many branches (16 > 12)
2025-12-12T20:43:18.5925811Z    --> stack_bootstrapper.py:290:5
2025-12-12T20:43:18.5926076Z     |
2025-12-12T20:43:18.5926272Z 288 |         )
2025-12-12T20:43:18.5926471Z 289 |
2025-12-12T20:43:18.5926779Z 290 | def _create_project_structure(args: argparse.Namespace) -> None:
2025-12-12T20:43:18.5927274Z     |     ^^^^^^^^^^^^^^^^^^^^^^^^^
2025-12-12T20:43:18.5927642Z 291 |     """Cria a estrutura básica de pastas do projeto."""
2025-12-12T20:43:18.5928089Z 292 |     _log("📁 Criando estrutura de pastas do projeto...", args)
2025-12-12T20:43:18.5928414Z     |
2025-12-12T20:43:18.5928521Z 
2025-12-12T20:43:18.5928701Z D202 [*] No blank lines allowed after function docstring (found 1)
2025-12-12T20:43:18.5929066Z    --> stack_bootstrapper.py:459:5
2025-12-12T20:43:18.5929334Z     |
2025-12-12T20:43:18.5929605Z 458 | def _add_dependencies(args: argparse.Namespace) -> None:
2025-12-12T20:43:18.5930130Z 459 |     """Adiciona as dependências de produção e desenvolvimento ao projeto."""
2025-12-12T20:43:18.5930551Z     |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-12-12T20:43:18.5930830Z 460 |
2025-12-12T20:43:18.5931108Z 461 |     # Dependências de produção são opcionais
2025-12-12T20:43:18.5931401Z     |
2025-12-12T20:43:18.5931651Z help: Remove blank line(s) after function docstring
2025-12-12T20:43:18.5931887Z 
2025-12-12T20:43:18.5932095Z RUF005 Consider `["poetry", "add", *prod_deps]` instead of concatenation
2025-12-12T20:43:18.5932481Z    --> stack_bootstrapper.py:467:22
2025-12-12T20:43:18.5932738Z     |
2025-12-12T20:43:18.5932949Z 465 |         if not _is_windows():
2025-12-12T20:43:18.5933234Z 466 |             prod_deps.append("uvloop")
2025-12-12T20:43:18.5933587Z 467 |         _run_command(["poetry", "add"] + prod_deps, args)
2025-12-12T20:43:18.5934041Z     |                      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-12-12T20:43:18.5934322Z 468 |     else:
2025-12-12T20:43:18.5934826Z 469 |         _log("⏭️  Pulando dependências de produção (use --install-runtime-deps para incluí-las).", args)
2025-12-12T20:43:18.5935276Z     |
2025-12-12T20:43:18.5935528Z help: Replace with `["poetry", "add", *prod_deps]`
2025-12-12T20:43:18.5935743Z 
2025-12-12T20:43:18.5935850Z E501 Line too long (103 > 88)
2025-12-12T20:43:18.5936129Z    --> stack_bootstrapper.py:469:90
2025-12-12T20:43:18.5936394Z     |
2025-12-12T20:43:18.5936652Z 467 |         _run_command(["poetry", "add"] + prod_deps, args)
2025-12-12T20:43:18.5936967Z 468 |     else:
2025-12-12T20:43:18.5937447Z 469 |         _log("⏭️  Pulando dependências de produção (use --install-runtime-deps para incluí-las).", args)
2025-12-12T20:43:18.5937954Z     |                                                                                         ^^^^^^^^^^^^^^^
2025-12-12T20:43:18.5938379Z 470 |
2025-12-12T20:43:18.5938736Z 471 |     _log("🔧 Adicionando dependências de desenvolvimento...", args)
2025-12-12T20:43:18.5939080Z     |
2025-12-12T20:43:18.5939195Z 
2025-12-12T20:43:18.5939436Z RUF005 Consider `["poetry", "add", "--group", "dev", *dev_deps]` instead of concatenation
2025-12-12T20:43:18.5939863Z    --> stack_bootstrapper.py:476:18
2025-12-12T20:43:18.5940125Z     |
2025-12-12T20:43:18.5940380Z 474 |         "pytest", "pytest-cov", "py-spy", "semgrep"
2025-12-12T20:43:18.5940680Z 475 |     ]
2025-12-12T20:43:18.5941000Z 476 |     _run_command(["poetry", "add", "--group", "dev"] + dev_deps, args)
2025-12-12T20:43:18.5941380Z     |                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-12-12T20:43:18.5941661Z 477 |
2025-12-12T20:43:18.5941958Z 478 | def _setup_pre_commit_hooks(args: argparse.Namespace) -> None:
2025-12-12T20:43:18.5942304Z     |
2025-12-12T20:43:18.5942599Z help: Replace with `["poetry", "add", "--group", "dev", *dev_deps]`
2025-12-12T20:43:18.5942870Z 
2025-12-12T20:43:18.5942982Z E501 Line too long (120 > 88)
2025-12-12T20:43:18.5943262Z    --> stack_bootstrapper.py:485:89
2025-12-12T20:43:18.5943518Z     |
2025-12-12T20:43:18.5943764Z 483 | def _setup_cli() -> argparse.Namespace:
2025-12-12T20:43:18.5944242Z 484 |     """Configura a interface de linha de comando."""
2025-12-12T20:43:18.5944951Z 485 |     parser = argparse.ArgumentParser(description="Automatiza a configuração de um ambiente Python de alta performance.")
2025-12-12T20:43:18.5945563Z     |                                                                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-12-12T20:43:18.5946026Z 486 |     parser.add_argument(
2025-12-12T20:43:18.5946288Z 487 |         "--dry-run",
2025-12-12T20:43:18.5946509Z     |
2025-12-12T20:43:18.5946625Z 
2025-12-12T20:43:18.5946733Z E501 Line too long (116 > 88)
2025-12-12T20:43:18.5947000Z    --> stack_bootstrapper.py:542:88
2025-12-12T20:43:18.5947259Z     |
2025-12-12T20:43:18.5947637Z 540 |     _log("\n✅ Ambiente configurado com sucesso!", args)
2025-12-12T20:43:18.5948094Z 541 |     _log("Execute `poetry shell` para ativar o ambiente virtual.", args)
2025-12-12T20:43:18.5948782Z 542 |     _log("💡 Dica: execute `poetry config virtualenvs.in-project true` para criar o .venv dentro do projeto.", args)
2025-12-12T20:43:18.5949331Z     |                                                                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-12-12T20:43:18.5949906Z 543 |     _log("\n🔒 Lembre-se de commitar o arquivo `poetry.lock` para garantir builds reprodutíveis.", args)
2025-12-12T20:43:18.5950554Z 544 |     _log("\n📚 Consulte o README.md para mais informações sobre o projeto.", args)
2025-12-12T20:43:18.5950944Z     |
2025-12-12T20:43:18.5951056Z 
2025-12-12T20:43:18.5951170Z E501 Line too long (104 > 88)
2025-12-12T20:43:18.5951439Z    --> stack_bootstrapper.py:543:88
2025-12-12T20:43:18.5951703Z     |
2025-12-12T20:43:18.5952010Z 541 |     _log("Execute `poetry shell` para ativar o ambiente virtual.", args)
2025-12-12T20:43:18.5952721Z 542 |     _log("💡 Dica: execute `poetry config virtualenvs.in-project true` para criar o .venv dentro do projeto.", args)
2025-12-12T20:43:18.5953466Z 543 |     _log("\n🔒 Lembre-se de commitar o arquivo `poetry.lock` para garantir builds reprodutíveis.", args)
2025-12-12T20:43:18.5954097Z     |                                                                                         ^^^^^^^^^^^^^^^^
2025-12-12T20:43:18.5954600Z 544 |     _log("\n📚 Consulte o README.md para mais informações sobre o projeto.", args)
2025-12-12T20:43:18.5954999Z     |
2025-12-12T20:43:18.5955116Z 
2025-12-12T20:43:18.5955245Z ARG002 Unused method argument: `tmp_path`
2025-12-12T20:43:18.5955557Z    --> tests/test_config_models.py:131:44
2025-12-12T20:43:18.5955834Z     |
2025-12-12T20:43:18.5956071Z 129 |             StackConfig(python_version="2.7")
2025-12-12T20:43:18.5956360Z 130 |
2025-12-12T20:43:18.5956663Z 131 |     def test_path_traversal_rejected(self, tmp_path: Path) -> None:
2025-12-12T20:43:18.5957185Z     |                                            ^^^^^^^^
2025-12-12T20:43:18.5957536Z 132 |         """Test path traversal in project_dir is rejected."""
2025-12-12T20:43:18.5957960Z 133 |         with pytest.raises(ValidationError, match="Path traversal"):
2025-12-12T20:43:18.5958307Z     |
2025-12-12T20:43:18.5958418Z 
2025-12-12T20:43:18.5958701Z SIM117 Use a single `with` statement with multiple contexts instead of nested `with` statements
2025-12-12T20:43:18.5959167Z   --> tests/test_secure_system.py:64:5
2025-12-12T20:43:18.5959447Z    |
2025-12-12T20:43:18.5959681Z 62 |       service = UserService(repository)
2025-12-12T20:43:18.5959980Z 63 |       user_id = uuid4()
2025-12-12T20:43:18.5960268Z 64 | /     with caplog.at_level(logging.WARNING):
2025-12-12T20:43:18.5960642Z 65 | |         with pytest.raises(UserNotFoundError) as exc_info:
2025-12-12T20:43:18.5961010Z    | |__________________________________________________________^
2025-12-12T20:43:18.5961350Z 66 |               service.get_user(user_id)
2025-12-12T20:43:18.5961618Z    |
2025-12-12T20:43:18.5961845Z help: Combine `with` statements
2025-12-12T20:43:18.5962013Z 
2025-12-12T20:43:18.5962283Z RUF043 Pattern passed to `match=` contains metacharacters but is neither escaped nor raw
2025-12-12T20:43:18.5962740Z   --> tests/test_security_validators.py:69:46
2025-12-12T20:43:18.5963027Z    |
2025-12-12T20:43:18.5963255Z 67 |             validate_python_version("3.9")
2025-12-12T20:43:18.5963538Z 68 |
2025-12-12T20:43:18.5963818Z 69 |         with pytest.raises(ValueError, match="Only Python 3.x"):
2025-12-12T20:43:18.5964449Z    |                                              ^^^^^^^^^^^^^^^^^
2025-12-12T20:43:18.5964765Z 70 |             validate_python_version("2.7")
2025-12-12T20:43:18.5965042Z    |
2025-12-12T20:43:18.5965354Z help: Use a raw string or `re.escape()` to make the intention explicit
2025-12-12T20:43:18.5965618Z 
2025-12-12T20:43:18.5965765Z I001 [*] Import block is un-sorted or un-formatted
2025-12-12T20:43:18.5966102Z  --> tests/test_stack_script.py:1:1
2025-12-12T20:43:18.5966362Z   |
2025-12-12T20:43:18.5966563Z 1 | / import sys
2025-12-12T20:43:18.5966790Z 2 | | import subprocess
2025-12-12T20:43:18.5967048Z 3 | | from pathlib import Path
2025-12-12T20:43:18.5967344Z 4 | | from unittest.mock import patch, MagicMock
2025-12-12T20:43:18.5967630Z 5 | |
2025-12-12T20:43:18.5967834Z 6 | | import pytest
2025-12-12T20:43:18.5968048Z   | |_____________^
2025-12-12T20:43:18.5968257Z 7 |
2025-12-12T20:43:18.5968686Z 8 |   # Adiciona o diretório raiz ao path para que o `stack_bootstrapper` possa ser importado
2025-12-12T20:43:18.5969105Z   |
2025-12-12T20:43:18.5969308Z help: Organize imports
2025-12-12T20:43:18.5969461Z 
2025-12-12T20:43:18.5969600Z I001 [*] Import block is un-sorted or un-formatted
2025-12-12T20:43:18.5969925Z   --> tests/test_stack_script.py:11:1
2025-12-12T20:43:18.5970184Z    |
2025-12-12T20:43:18.5970462Z  9 | sys.path.insert(0, str(Path(__file__).parent.parent))
2025-12-12T20:43:18.5970782Z 10 |
2025-12-12T20:43:18.5971011Z 11 | import stack_bootstrapper as stack
2025-12-12T20:43:18.5971297Z    | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-12-12T20:43:18.5971546Z    |
2025-12-12T20:43:18.5971745Z help: Organize imports
2025-12-12T20:43:18.5971894Z 
2025-12-12T20:43:18.5972082Z RUF005 Consider `["stack.py", *args]` instead of concatenation
2025-12-12T20:43:18.5972447Z   --> tests/test_stack_script.py:32:36
2025-12-12T20:43:18.5972713Z    |
2025-12-12T20:43:18.5972929Z 30 | def run_main_with_args(args):
2025-12-12T20:43:18.5973393Z 31 |     """Helper para rodar a função main do script com argumentos específicos."""
2025-12-12T20:43:18.5973859Z 32 |     with patch.object(sys, "argv", ["stack.py"] + args):
2025-12-12T20:43:18.5974309Z    |                                    ^^^^^^^^^^^^^^^^^^^
2025-12-12T20:43:18.5974603Z 33 |         stack.main()
2025-12-12T20:43:18.5974828Z    |
2025-12-12T20:43:18.5975058Z help: Replace with `["stack.py", *args]`
2025-12-12T20:43:18.5975248Z 
2025-12-12T20:43:18.5975511Z E501 Line too long (92 > 88)
2025-12-12T20:43:18.5975787Z   --> tests/test_stack_script.py:66:89
2025-12-12T20:43:18.5976058Z    |
2025-12-12T20:43:18.5976353Z 64 |     # Verifica se o novo arquivo também foi criado
2025-12-12T20:43:18.5976686Z 65 |     assert dummy_file.exists()
2025-12-12T20:43:18.5977193Z 66 |     assert "pre-commit-hooks" in dummy_file.read_text()  # Verifica conteúdo do novo arquivo
2025-12-12T20:43:18.5977675Z    |                                                                                         ^^^^
2025-12-12T20:43:18.5977969Z    |
2025-12-12T20:43:18.5978087Z 
2025-12-12T20:43:18.5978228Z ARG001 Unused function argument: `monkeypatch`
2025-12-12T20:43:18.5978563Z    --> tests/test_stack_script.py:150:47
2025-12-12T20:43:18.5978827Z     |
2025-12-12T20:43:18.5979120Z 150 | def test_optional_dependencies_flag(tmp_path, monkeypatch):
2025-12-12T20:43:18.5979484Z     |                                               ^^^^^^^^^^^
2025-12-12T20:43:18.5979772Z 151 |     """
2025-12-12T20:43:18.5980212Z 152 |     Verifica se a flag --install-runtime-deps controla a instalação de dependências.
2025-12-12T20:43:18.5980621Z     |
2025-12-12T20:43:18.5980731Z 
2025-12-12T20:43:18.5980881Z ARG001 Unused function argument: `monkeypatch`
2025-12-12T20:43:18.5981203Z    --> tests/test_stack_script.py:170:46
2025-12-12T20:43:18.5981470Z     |
2025-12-12T20:43:18.5981749Z 170 | def test_install_runtime_deps_flag(tmp_path, monkeypatch):
2025-12-12T20:43:18.5982110Z     |                                              ^^^^^^^^^^^
2025-12-12T20:43:18.5982514Z 171 |     """
2025-12-12T20:43:18.5982933Z 172 |     Verifica se --install-runtime-deps instala as dependências de produção.
2025-12-12T20:43:18.5983313Z     |
2025-12-12T20:43:18.5983428Z 
2025-12-12T20:43:18.5983707Z SIM117 Use a single `with` statement with multiple contexts instead of nested `with` statements
2025-12-12T20:43:18.5984313Z    --> tests/test_stack_script.py:178:5
2025-12-12T20:43:18.5984585Z     |
2025-12-12T20:43:18.5984890Z 177 |       # Mock platform.system to avoid subprocess issues on Windows
2025-12-12T20:43:18.5985386Z 178 | /     with patch("stack_bootstrapper.platform.system", return_value="Linux"):
2025-12-12T20:43:18.5985827Z 179 | |         with patch("subprocess.run") as mock_run:
2025-12-12T20:43:18.5986159Z     | |_________________________________________________^
2025-12-12T20:43:18.5986548Z 180 |               mock_run.return_value = subprocess.CompletedProcess([], 0)
2025-12-12T20:43:18.5986970Z 181 |               run_main_with_args(["--install-runtime-deps"])
2025-12-12T20:43:18.5987285Z     |
2025-12-12T20:43:18.5987505Z help: Combine `with` statements
2025-12-12T20:43:18.5987674Z 
2025-12-12T20:43:18.5987780Z E501 Line too long (96 > 88)
2025-12-12T20:43:18.5988055Z    --> tests/test_stack_script.py:191:89
2025-12-12T20:43:18.5988326Z     |
2025-12-12T20:43:18.5988604Z 189 |                 and any("pydantic" in str(arg) for arg in call[0][0])
2025-12-12T20:43:18.5988929Z 190 |             ]
2025-12-12T20:43:18.5989315Z 191 |             assert len(poetry_add_calls) > 0, "Poetry add with pydantic should have been called"
2025-12-12T20:43:18.5989774Z     |                                                                                         ^^^^^^^^
2025-12-12T20:43:18.5990059Z     |
2025-12-12T20:43:18.5990172Z 
2025-12-12T20:43:18.5990332Z PLC0415 `import` should be at the top-level of a file
2025-12-12T20:43:18.5990668Z    --> tests/test_stack_script.py:206:5
2025-12-12T20:43:18.5990939Z     |
2025-12-12T20:43:18.5991270Z 205 |     # Verifica se a versão do Python está na configuração
2025-12-12T20:43:18.5991604Z 206 |     import sys
2025-12-12T20:43:18.5991839Z     |     ^^^^^^^^^^
2025-12-12T20:43:18.5992192Z 207 |     expected_version = f"{sys.version_info.major}.{sys.version_info.minor}"
2025-12-12T20:43:18.5992662Z 208 |     assert f'python_version = "{expected_version}"' in content
2025-12-12T20:43:18.5992989Z     |
2025-12-12T20:43:18.5993104Z 
2025-12-12T20:43:18.5993200Z Found 69 errors.
2025-12-12T20:43:18.5993753Z [*] 8 fixable with the `--fix` option (10 hidden fixes can be enabled with the `--unsafe-fixes` option).
2025-12-12T20:43:18.6003360Z ##[error]Process completed with exit code 1.
