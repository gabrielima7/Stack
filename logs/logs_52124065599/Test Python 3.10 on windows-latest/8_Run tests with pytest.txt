2025-12-12T20:43:59.3043853Z ##[group]Run poetry run pytest tests/ -v --cov=src --cov-report=xml --cov-report=term --timeout=60
2025-12-12T20:43:59.3044550Z [36;1mpoetry run pytest tests/ -v --cov=src --cov-report=xml --cov-report=term --timeout=60[0m
2025-12-12T20:43:59.3114427Z shell: C:\Program Files\PowerShell\7\pwsh.EXE -command ". '{0}'"
2025-12-12T20:43:59.3114753Z env:
2025-12-12T20:43:59.3114914Z   PYTHON_VERSION_DEFAULT: 3.11
2025-12-12T20:43:59.3115192Z   pythonLocation: C:\hostedtoolcache\windows\Python\3.10.11\x64
2025-12-12T20:43:59.3115601Z   PKG_CONFIG_PATH: C:\hostedtoolcache\windows\Python\3.10.11\x64/lib/pkgconfig
2025-12-12T20:43:59.3115998Z   Python_ROOT_DIR: C:\hostedtoolcache\windows\Python\3.10.11\x64
2025-12-12T20:43:59.3116351Z   Python2_ROOT_DIR: C:\hostedtoolcache\windows\Python\3.10.11\x64
2025-12-12T20:43:59.3116698Z   Python3_ROOT_DIR: C:\hostedtoolcache\windows\Python\3.10.11\x64
2025-12-12T20:43:59.3116962Z ##[endgroup]
2025-12-12T20:44:03.2713265Z ============================= test session starts =============================
2025-12-12T20:44:03.2714029Z platform win32 -- Python 3.10.11, pytest-9.0.2, pluggy-1.6.0 -- D:\a\Stack\Stack\.venv\Scripts\python.exe
2025-12-12T20:44:03.2714544Z cachedir: .pytest_cache
2025-12-12T20:44:03.2715163Z hypothesis profile 'ci' -> database=None, deadline=None, print_blob=True, derandomize=True, suppress_health_check=(HealthCheck.too_slow,)
2025-12-12T20:44:03.2715841Z rootdir: D:\a\Stack\Stack
2025-12-12T20:44:03.2716088Z configfile: pyproject.toml
2025-12-12T20:44:03.2716481Z plugins: anyio-4.12.0, hypothesis-6.148.7, cov-7.0.0, timeout-2.4.0, xdist-3.8.0
2025-12-12T20:44:03.2716898Z timeout: 60.0s
2025-12-12T20:44:03.2717094Z timeout method: thread
2025-12-12T20:44:03.2717321Z timeout func_only: False
2025-12-12T20:44:03.8292436Z collecting ... collected 74 items
2025-12-12T20:44:03.8292741Z 
2025-12-12T20:44:03.8425515Z tests/test_config_models.py::TestSecurityConfig::test_default_values PASSED [  1%]
2025-12-12T20:44:03.8448688Z tests/test_config_models.py::TestSecurityConfig::test_paranoid_level PASSED [  2%]
2025-12-12T20:44:03.8477164Z tests/test_config_models.py::TestSecurityConfig::test_frozen_config PASSED [  4%]
2025-12-12T20:44:03.8499007Z tests/test_config_models.py::TestSecurityConfig::test_extra_fields_forbidden PASSED [  5%]
2025-12-12T20:44:03.8519998Z tests/test_config_models.py::TestDependencyConfig::test_default_values PASSED [  6%]
2025-12-12T20:44:03.8546583Z tests/test_config_models.py::TestDependencyConfig::test_custom_dependencies PASSED [  8%]
2025-12-12T20:44:03.8568503Z tests/test_config_models.py::TestLoggingConfig::test_default_values PASSED [  9%]
2025-12-12T20:44:03.8589606Z tests/test_config_models.py::TestLoggingConfig::test_valid_levels PASSED [ 10%]
2025-12-12T20:44:03.8611544Z tests/test_config_models.py::TestLoggingConfig::test_invalid_level_rejected PASSED [ 12%]
2025-12-12T20:44:03.8640513Z tests/test_config_models.py::TestStackConfig::test_default_values PASSED [ 13%]
2025-12-12T20:44:03.8664651Z tests/test_config_models.py::TestStackConfig::test_valid_project_name PASSED [ 14%]
2025-12-12T20:44:03.8695160Z tests/test_config_models.py::TestStackConfig::test_invalid_project_name_rejected PASSED [ 16%]
2025-12-12T20:44:03.8722423Z tests/test_config_models.py::TestStackConfig::test_valid_python_version PASSED [ 17%]
2025-12-12T20:44:03.8747311Z tests/test_config_models.py::TestStackConfig::test_invalid_python_version_rejected PASSED [ 18%]
2025-12-12T20:44:03.8900788Z tests/test_config_models.py::TestStackConfig::test_path_traversal_rejected PASSED [ 20%]
2025-12-12T20:44:03.8928516Z tests/test_config_models.py::TestStackConfig::test_paranoid_requires_all_tools PASSED [ 21%]
2025-12-12T20:44:03.8952538Z tests/test_config_models.py::TestStackConfig::test_to_target_version PASSED [ 22%]
2025-12-12T20:44:03.8978890Z tests/test_config_models.py::TestStackConfig::test_nested_configs PASSED [ 24%]
2025-12-12T20:44:03.8999045Z tests/test_example.py::test_greet PASSED                                 [ 25%]
2025-12-12T20:44:03.9020940Z tests/test_example.py::test_greet_empty PASSED                           [ 27%]
2025-12-12T20:44:03.9852813Z tests/test_secure_system.py::test_create_user_success PASSED             [ 28%]
2025-12-12T20:44:03.9874591Z tests/test_secure_system.py::test_create_user_invalid_email PASSED       [ 29%]
2025-12-12T20:44:03.9897942Z tests/test_secure_system.py::test_create_user_invalid_username PASSED    [ 31%]
2025-12-12T20:44:03.9925097Z tests/test_secure_system.py::test_get_non_existent_user PASSED           [ 32%]
2025-12-12T20:44:03.9975502Z tests/test_security_guards.py::TestGuardPathTraversal::test_safe_path_passes PASSED [ 33%]
2025-12-12T20:44:04.0031089Z tests/test_security_guards.py::TestGuardPathTraversal::test_relative_path_within_base PASSED [ 35%]
2025-12-12T20:44:04.0076260Z tests/test_security_guards.py::TestGuardPathTraversal::test_path_traversal_blocked PASSED [ 36%]
2025-12-12T20:44:04.0118868Z tests/test_security_guards.py::TestGuardPathTraversal::test_double_dot_blocked PASSED [ 37%]
2025-12-12T20:44:04.0167516Z tests/test_security_guards.py::TestGuardPathTraversal::test_url_encoded_traversal_blocked PASSED [ 39%]
2025-12-12T20:44:04.0705654Z tests/test_security_guards.py::TestGuardPathTraversal::test_path_escapes_base_dir FAILED [ 40%]
2025-12-12T20:44:04.0728320Z tests/test_security_guards.py::TestGuardCommandInjection::test_safe_command_passes PASSED [ 41%]
2025-12-12T20:44:04.0750177Z tests/test_security_guards.py::TestGuardCommandInjection::test_empty_command_blocked PASSED [ 43%]
2025-12-12T20:44:04.0772209Z tests/test_security_guards.py::TestGuardCommandInjection::test_semicolon_blocked PASSED [ 44%]
2025-12-12T20:44:04.0794252Z tests/test_security_guards.py::TestGuardCommandInjection::test_pipe_blocked PASSED [ 45%]
2025-12-12T20:44:04.0815747Z tests/test_security_guards.py::TestGuardCommandInjection::test_backtick_blocked PASSED [ 47%]
2025-12-12T20:44:04.0837056Z tests/test_security_guards.py::TestGuardCommandInjection::test_dollar_expansion_blocked PASSED [ 48%]
2025-12-12T20:44:04.0859351Z tests/test_security_guards.py::TestGuardCommandInjection::test_allowed_commands_whitelist PASSED [ 50%]
2025-12-12T20:44:04.0880993Z tests/test_security_guards.py::TestGuardCommandInjection::test_command_not_in_whitelist_blocked PASSED [ 51%]
2025-12-12T20:44:04.0902549Z tests/test_security_guards.py::TestGuardFileExtension::test_safe_extension_passes PASSED [ 52%]
2025-12-12T20:44:04.0923809Z tests/test_security_guards.py::TestGuardFileExtension::test_dangerous_extension_blocked PASSED [ 54%]
2025-12-12T20:44:04.0946676Z tests/test_security_guards.py::TestGuardFileExtension::test_custom_denied_extensions PASSED [ 55%]
2025-12-12T20:44:04.0969105Z tests/test_security_guards.py::TestGuardFileExtension::test_extension_with_dot PASSED [ 56%]
2025-12-12T20:44:04.0994465Z tests/test_security_validators.py::TestValidateProjectName::test_valid_project_name PASSED [ 58%]
2025-12-12T20:44:04.1018022Z tests/test_security_validators.py::TestValidateProjectName::test_empty_name_rejected PASSED [ 59%]
2025-12-12T20:44:04.1041465Z tests/test_security_validators.py::TestValidateProjectName::test_name_must_start_with_letter PASSED [ 60%]
2025-12-12T20:44:04.1064245Z tests/test_security_validators.py::TestValidateProjectName::test_reserved_names_rejected PASSED [ 62%]
2025-12-12T20:44:04.1087787Z tests/test_security_validators.py::TestValidateProjectName::test_max_length_enforced PASSED [ 63%]
2025-12-12T20:44:04.1108750Z tests/test_security_validators.py::TestValidatePythonVersion::test_valid_versions PASSED [ 64%]
2025-12-12T20:44:04.1132789Z tests/test_security_validators.py::TestValidatePythonVersion::test_invalid_format_rejected PASSED [ 66%]
2025-12-12T20:44:04.1158004Z tests/test_security_validators.py::TestValidatePythonVersion::test_unsupported_version_rejected PASSED [ 67%]
2025-12-12T20:44:04.1182192Z tests/test_security_validators.py::TestValidateEmail::test_valid_emails PASSED [ 68%]
2025-12-12T20:44:04.1203029Z tests/test_security_validators.py::TestValidateEmail::test_empty_email_rejected PASSED [ 70%]
2025-12-12T20:44:04.1226315Z tests/test_security_validators.py::TestValidateEmail::test_invalid_format_rejected PASSED [ 71%]
2025-12-12T20:44:04.1252187Z tests/test_security_validators.py::TestValidateUrl::test_valid_urls PASSED [ 72%]
2025-12-12T20:44:04.1273717Z tests/test_security_validators.py::TestValidateUrl::test_empty_url_rejected PASSED [ 74%]
2025-12-12T20:44:04.1297522Z tests/test_security_validators.py::TestValidateUrl::test_missing_scheme_rejected PASSED [ 75%]
2025-12-12T20:44:04.1320698Z tests/test_security_validators.py::TestValidateUrl::test_invalid_scheme_rejected PASSED [ 77%]
2025-12-12T20:44:04.1341707Z tests/test_security_validators.py::TestValidateIpAddress::test_valid_ipv4 PASSED [ 78%]
2025-12-12T20:44:04.1362834Z tests/test_security_validators.py::TestValidateIpAddress::test_valid_ipv6 PASSED [ 79%]
2025-12-12T20:44:04.1386335Z tests/test_security_validators.py::TestValidateIpAddress::test_invalid_ip_rejected PASSED [ 81%]
2025-12-12T20:44:04.1407820Z tests/test_security_validators.py::TestValidatePort::test_valid_ports PASSED [ 82%]
2025-12-12T20:44:04.1430687Z tests/test_security_validators.py::TestValidatePort::test_invalid_port_rejected PASSED [ 83%]
2025-12-12T20:44:04.1453261Z tests/test_security_validators.py::TestValidatePort::test_privileged_ports_blocked PASSED [ 85%]
2025-12-12T20:44:04.1481518Z tests/test_security_validators.py::TestValidateSemver::test_valid_semver PASSED [ 86%]
2025-12-12T20:44:04.1506221Z tests/test_security_validators.py::TestValidateSemver::test_invalid_semver_rejected PASSED [ 87%]
2025-12-12T20:44:04.2145798Z tests/test_stack_script.py::test_dry_run_does_not_create_files PASSED    [ 89%]
2025-12-12T20:44:04.2640800Z tests/test_stack_script.py::test_safe_write_creates_backup PASSED        [ 90%]
2025-12-12T20:44:04.3143320Z tests/test_stack_script.py::test_force_mode_overwrites_without_backup PASSED [ 91%]
2025-12-12T20:44:04.4262199Z tests/test_stack_script.py::test_idempotency_for_pyproject_toml PASSED   [ 93%]
2025-12-12T20:44:04.4888361Z tests/test_stack_script.py::test_git_initialization PASSED               [ 94%]
2025-12-12T20:44:04.5416476Z tests/test_stack_script.py::test_project_structure_creation PASSED       [ 95%]
2025-12-12T20:44:04.5966770Z tests/test_stack_script.py::test_optional_dependencies_flag PASSED       [ 97%]
2025-12-12T20:44:04.6564652Z tests/test_stack_script.py::test_install_runtime_deps_flag PASSED        [ 98%]
2025-12-12T20:44:05.6468826Z tests/test_stack_script.py::test_python_version_detection PASSED         [100%]
2025-12-12T20:44:05.6469785Z ERROR: Coverage failure: total of 36 is less than fail-under=80
2025-12-12T20:44:05.6470262Z 
2025-12-12T20:44:05.6470270Z 
2025-12-12T20:44:05.6470434Z ================================== FAILURES ===================================
2025-12-12T20:44:05.6470948Z ______________ TestGuardPathTraversal.test_path_escapes_base_dir ______________
2025-12-12T20:44:05.6471323Z 
2025-12-12T20:44:05.6471644Z self = <tests.test_security_guards.TestGuardPathTraversal object at 0x000001DBD9C0E770>
2025-12-12T20:44:05.6472579Z tmp_path = WindowsPath('C:/Users/runneradmin/AppData/Local/Temp/pytest-of-runneradmin/pytest-0/test_path_escapes_base_dir0')
2025-12-12T20:44:05.6473182Z 
2025-12-12T20:44:05.6473374Z     def test_path_escapes_base_dir(self, tmp_path: Path) -> None:
2025-12-12T20:44:05.6474037Z         """Test that paths escaping base dir are blocked."""
2025-12-12T20:44:05.6474414Z         with TemporaryDirectory() as other_dir:
2025-12-12T20:44:05.6474779Z             with pytest.raises(SecurityError) as exc_info:
2025-12-12T20:44:05.6475168Z                 guard_path_traversal(Path(other_dir), tmp_path)
2025-12-12T20:44:05.6475573Z >           assert "escapes base directory" in str(exc_info.value)
2025-12-12T20:44:05.6476211Z E           AssertionError: assert 'escapes base directory' in '[path_traversal] Path traversal pattern detected: ~'
2025-12-12T20:44:05.6477314Z E            +  where '[path_traversal] Path traversal pattern detected: ~' = str(SecurityError('[path_traversal] Path traversal pattern detected: ~'))
2025-12-12T20:44:05.6478956Z E            +    where SecurityError('[path_traversal] Path traversal pattern detected: ~') = <ExceptionInfo SecurityError('[path_traversal] Path traversal pattern detected: ~') tblen=2>.value
2025-12-12T20:44:05.6479762Z 
2025-12-12T20:44:05.6479895Z tests\test_security_guards.py:60: AssertionError
2025-12-12T20:44:05.6480258Z =============================== tests coverage ================================
2025-12-12T20:44:05.6480706Z ______________ coverage: platform win32, python 3.10.11-final-0 _______________
2025-12-12T20:44:05.6481035Z 
2025-12-12T20:44:05.6481182Z Name                               Stmts   Miss Branch BrPart  Cover   Missing
2025-12-12T20:44:05.6481598Z ------------------------------------------------------------------------------
2025-12-12T20:44:05.6482030Z src\app\__init__.py                    1      0      0      0   100%
2025-12-12T20:44:05.6482437Z src\app\main.py                        8      2      0      0    75%   25-26
2025-12-12T20:44:05.6482859Z src\app\secure_system.py              45      0      2      0   100%
2025-12-12T20:44:05.6483287Z src\stack\__init__.py                  5      0      0      0   100%
2025-12-12T20:44:05.6483720Z src\stack\config\__init__.py           3      0      0      0   100%
2025-12-12T20:44:05.6484260Z src\stack\config\generators.py        34     25     14      0    19%   27-28, 124-182, 218, 264, 311, 349-357
2025-12-12T20:44:05.6484770Z src\stack\config\models.py            73      2     12      1    96%   235-236
2025-12-12T20:44:05.6485136Z src\stack\security\__init__.py         4      0      0      0   100%
2025-12-12T20:44:05.6485560Z src\stack\security\guards.py          83     25     44      4    66%   100-101, 109-110, 117->125, 119, 250->259, 253, 283-348
2025-12-12T20:44:05.6486030Z src\stack\security\sanitizers.py     104     95     58      0     6%   40-70, 100-152, 177-224, 244-260, 278-297
2025-12-12T20:44:05.6486634Z src\stack\security\validators.py     125     25     54     11    80%   54->56, 56->59, 65-66, 114-116, 160-161, 164-165, 196-198, 209-210, 212->221, 218-219, 251-252, 255-256, 259-260, 285-287
2025-12-12T20:44:05.6487163Z src\stack\utils\__init__.py            4      4      0      0     0%   3-7
2025-12-12T20:44:05.6487677Z src\stack\utils\filesystem.py        113    113     62      0     0%   8-349
2025-12-12T20:44:05.6488052Z src\stack\utils\logging.py            99     99     32      0     0%   8-324
2025-12-12T20:44:05.6488412Z src\stack\utils\subprocess.py         73     73     26      0     0%   8-340
2025-12-12T20:44:05.6488752Z ------------------------------------------------------------------------------
2025-12-12T20:44:05.6489038Z TOTAL                                774    463    304     16    36%
2025-12-12T20:44:05.6489302Z Coverage HTML written to dir htmlcov
2025-12-12T20:44:05.6489532Z Coverage XML written to file coverage.xml
2025-12-12T20:44:05.6489854Z FAIL Required test coverage of 80.0% not reached. Total coverage: 36.46%
2025-12-12T20:44:05.6490213Z =========================== short test summary info ===========================
2025-12-12T20:44:05.6490959Z FAILED tests/test_security_guards.py::TestGuardPathTraversal::test_path_escapes_base_dir - AssertionError: assert 'escapes base directory' in '[path_traversal] Path traversal pattern detected: ~'
2025-12-12T20:44:05.6491934Z  +  where '[path_traversal] Path traversal pattern detected: ~' = str(SecurityError('[path_traversal] Path traversal pattern detected: ~'))
2025-12-12T20:44:05.6492833Z  +    where SecurityError('[path_traversal] Path traversal pattern detected: ~') = <ExceptionInfo SecurityError('[path_traversal] Path traversal pattern detected: ~') tblen=2>.value
2025-12-12T20:44:05.6493485Z ======================== 1 failed, 73 passed in 3.37s =========================
2025-12-12T20:44:05.9536894Z ##[error]Process completed with exit code 1.
